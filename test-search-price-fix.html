<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test - Fix NaN Price en Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .search-card {
      border: 1px solid #ddd;
      padding: 15px;
      margin: 10px;
      border-radius: 8px;
      display: inline-block;
      width: 250px;
      vertical-align: top;
    }
    .search-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 4px;
    }
    .search-card h3 {
      margin: 10px 0;
      font-size: 16px;
    }
    .search-card__category {
      color: #666;
      font-size: 14px;
    }
    .search-card__price {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #2c3e50;
    }
    .search-card__discount {
      background: #e74c3c;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      margin-left: 8px;
    }
    .success { color: #27ae60; }
    .error { color: #e74c3c; }
    .warning { color: #f39c12; }
  </style>
</head>
<body>
  <h1>üß™ Test - Fix NaN Price en Search</h1>
  
  <div class="test-section">
    <h2>üìã Informaci√≥n del Test</h2>
    <p>Este test verifica que los productos con variantes muestren correctamente el precio en la b√∫squeda.</p>
    <p><strong>Producto de prueba:</strong> SHAMPOO MAXIMO 250 cm3 (prod_106)</p>
  </div>

  <div class="test-section">
    <h2>üîç Resultados</h2>
    <div id="results"></div>
  </div>

  <script src="js/core/constants.js"></script>
  <script src="js/core/utils.js"></script>
  <script src="js/core/dataLoader.js"></script>
  <script>
    async function runTest() {
      const resultsDiv = document.getElementById('results');
      
      try {
        // Cargar productos
        const products = await dataLoader.getProducts();
        console.log('‚úÖ Productos cargados:', products.length);
        
        // Buscar el producto con variantes
        const productWithVariants = products.find(p => p.id === 'prod_106');
        
        if (!productWithVariants) {
          resultsDiv.innerHTML = '<p class="error">‚ùå No se encontr√≥ el producto prod_106</p>';
          return;
        }
        
        console.log('üì¶ Producto encontrado:', productWithVariants);
        
        // Verificar estructura
        resultsDiv.innerHTML += `
          <h3>üì¶ Producto: ${productWithVariants.name}</h3>
          <ul>
            <li>ID: ${productWithVariants.id}</li>
            <li>hasVariants: <span class="${productWithVariants.hasVariants ? 'success' : 'error'}">${productWithVariants.hasVariants}</span></li>
            <li>basePrice: <span class="${productWithVariants.basePrice ? 'success' : 'error'}">${productWithVariants.basePrice || 'undefined'}</span></li>
            <li>price: <span class="${productWithVariants.price ? 'success' : 'warning'}">${productWithVariants.price || 'undefined'}</span></li>
            <li>discount: ${productWithVariants.discount}%</li>
          </ul>
        `;
        
        // Simular renderizado de tarjeta
        const displayPrice = productWithVariants.hasVariants ? productWithVariants.basePrice : productWithVariants.price;
        
        resultsDiv.innerHTML += `
          <h3>üí∞ Precio a mostrar</h3>
          <p>displayPrice = ${displayPrice}</p>
          <p>Formateado: <strong>${Utils.formatPrice(displayPrice)}</strong></p>
        `;
        
        // Renderizar tarjeta
        const cardHTML = `
          <div class="search-card">
            <img src="${productWithVariants.images.thumb}" alt="${productWithVariants.name}" loading="lazy">
            <h3>${productWithVariants.name}</h3>
            <p class="search-card__category">${productWithVariants.category}</p>
            <div class="search-card__price">
              <span>${Utils.formatPrice(displayPrice)}</span>
              ${productWithVariants.discount ? `<span class="search-card__discount">-${productWithVariants.discount}%</span>` : ''}
            </div>
          </div>
        `;
        
        resultsDiv.innerHTML += `
          <h3>üé® Tarjeta Renderizada</h3>
          ${cardHTML}
        `;
        
        // Verificar si hay NaN
        if (cardHTML.includes('NaN')) {
          resultsDiv.innerHTML += '<p class="error">‚ùå ERROR: Se detect√≥ NaN en el HTML</p>';
        } else {
          resultsDiv.innerHTML += '<p class="success">‚úÖ No se detect√≥ NaN en el HTML</p>';
        }
        
      } catch (error) {
        console.error('‚ùå Error en test:', error);
        resultsDiv.innerHTML += `<p class="error">‚ùå Error: ${error.message}</p>`;
      }
    }
    
    // Ejecutar test cuando el DOM est√© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', runTest);
    } else {
      runTest();
    }
  </script>
</body>
</html>
