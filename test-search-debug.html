<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Debug Search</title>
</head>
<body>
  <h1>Debug de Búsqueda</h1>
  <div id="output" style="white-space: pre-wrap; font-family: monospace;"></div>
  
  <script src="js/core/constants.js"></script>
  <script src="js/core/utils.js"></script>
  <script src="js/core/dataLoader.js"></script>
  <script>
    const output = document.getElementById('output');
    
    function log(msg) {
      output.innerHTML += msg + '\n';
      console.log(msg);
    }
    
    async function debug() {
      log('=== DEBUG DE BÚSQUEDA ===\n');
      log('URL: ' + window.location.href);
      log('Hostname: ' + window.location.hostname);
      log('Pathname: ' + window.location.pathname);
      log('Protocol: ' + window.location.protocol);
      log('');
      
      log('DataLoader baseUrl: ' + dataLoader.baseUrl);
      log('');
      
      log('Cargando productos...');
      try {
        const products = await dataLoader.getProducts();
        log('Productos cargados: ' + (products ? products.length : 'NULL'));
        
        if (products && products.length > 0) {
          log('\nPrimeros 3 productos:');
          products.slice(0, 3).forEach((p, i) => {
            log(`  ${i+1}. ${p.name}`);
            log(`     - id: ${p.id}`);
            log(`     - category: ${p.category}`);
            log(`     - subcategory: ${p.subcategory}`);
            log(`     - tags: ${JSON.stringify(p.tags)}`);
          });
          
          log('\n=== TEST DE BÚSQUEDA ===');
          const query = 'camiseta';
          log(`Buscando: "${query}"`);
          
          const normalizedQuery = Utils.normalizeText(query);
          log(`Query normalizada: "${normalizedQuery}"`);
          
          const results = products.filter(product => {
            const matchName = product.name ? Utils.normalizeText(product.name).includes(normalizedQuery) : false;
            const matchCategory = product.category ? Utils.normalizeText(product.category).includes(normalizedQuery) : false;
            const matchSubcategory = product.subcategory ? Utils.normalizeText(product.subcategory).includes(normalizedQuery) : false;
            const matchTags = product.tags && Array.isArray(product.tags) ? product.tags.some(tag => Utils.normalizeText(tag).includes(normalizedQuery)) : false;
            const matchDescription = product.description ? Utils.normalizeText(product.description).includes(normalizedQuery) : false;
            return matchName || matchCategory || matchSubcategory || matchTags || matchDescription;
          });
          
          log(`Resultados: ${results.length}`);
          if (results.length > 0) {
            log('\nProductos encontrados:');
            results.slice(0, 5).forEach((p, i) => {
              log(`  ${i+1}. ${p.name}`);
            });
          }
        }
      } catch (error) {
        log('ERROR: ' + error.message);
        log('Stack: ' + error.stack);
      }
    }
    
    debug();
  </script>
</body>
</html>
